<!DOCTYPE html>
<html>
<head>
	<title>Практическая работа #12</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="720">
	<link rel="stylesheet" href="css/style.css">
    <link href="http://fonts.googleapis.com/css?family=Raleway:700,300" rel="stylesheet"
          type="text/css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/prettify.css">
</head>
<body>


<div class="wrapper">
    <nav>
        <div class="pull-left">
            <h1><a href="/os-mpt"><span>Все материалы</span></a></h1>
        </div>
        <div class="pull-right">
        </div>
    </nav>
    <header>
        <div class="container">
            <h2 class="lone-header">Лабораторная #12 по ОС</h2>
        </div>
    </header>
    <section>
        <div class="container">
            <ul class="docs-nav">
                <li><a href="#init" class="cc-active">Введение</a></li>
				<li><a href="#syn" class="cc-active">Синтаксис</a></li>
                <li><a href="#examp" class="cc-active">Примеры</a></li>                
                <li><a href="#qwe" class="cc-active">Контрольные вопросы</a></li>
                <li><a href="#source" class="cc-active">Ссылки</a></li>
            </ul>
			
            <div class="docs-content">
            <h2>Лабораторная работа №12 - «Работа с языком командного интерпретатора SHELL.</h2>

			<b>Цель работы:</b> Целью работы является изучение методов создания и выполнения командных файлов на языке Shell - интерпретатора 


             <h3 id="init">Введение</h3>

            <p>В предыдущих лабораторных работах взаимодействие с командным интерпретатором Shell осуществлялось с помощью командной строки. Однако, Shell является также и языком программирования, который применяется для написания командных файлов (shell - файлов). Командные файлы также называются скриптами и сценариями. Shell - файл содержит одну или несколько выполняемых команд (процедур), а имя файла в этом случае используется как имя команды.</p>
           
            <p>Командная оболочка в любых unix-подобных системах, к которым относится и GNU/Linux, является обычной программой, запускаемой как в текстовой консоли (которая используется всё реже), так и в графической среде – в окне эмулятора терминала, доступного в любой Linux-системе.</p>
            <p>Ее задача проста и очевидна: принять строку (или строки) ввода, произвести их синтаксический анализ и на основе результатов этого анализа отреагировать соответствующим образом – выполнить команду, запустить программу, вывести диагностическое сообщение и т.п.</p>

            <p>Почти во всех дистрибутивах Linux для пользователей по умолчанию назначается командная оболочка bash. </p>

            <p>Существуют и другие командные оболочки – tcsh (версия C-shell), ksh (Korn Shell), zsh и т.д. – у каждой есть свои достоинства и недостатки, а также свои группы поклонников.
            BASH — Bourne-Again SHell (что может переводится как «перерожденный шел», или «Снова шел Борна(создатель sh)»), самый популярный командный интерпретатор в "юниксоподобных" системах, в особенности в GNU/Linux. Ниже приведу ряд встроенных команд, которые мы будем использовать для создания своих скриптов.</p>

            <p>Для того, чтобы узнать название shell Linux, используемой в текущий момент, необходимо выполнить всего 2 простых шага:
            <ol>
                <li>Откройте Терминал.</li>
                <li>Выполните в командной строке следующую команду:ECHO $SHELL Эта команда отобразит название используемой shell.</li>
            </ol> 
            </p>

            <p>Разумеется, этот язык не компилируемый, а интерпретируемый. Он допускает использование переменных: системных или собственных. Последовательность выполнения команд программы изменяется с помощью конструкций проверки условия и выбора соответствующего варианта: if-then-else и case. Циклы while, until и for позволяют автоматизировать многократно повторяющиеся действия. Имеется возможность объединять группы команд в логические блоки. Вы можете даже писать настоящие функции с передачей в них параметров. Таким образом, налицо все признаки и характеристики полноценного языка программирования.</p>

            <p>В простейшем случае, скрипт -- это ни что иное, как простой список команд системы, записанный в файл. Создание скриптов поможет сохранить ваше время и силы, которые тратятся на ввод последовательности команд всякий раз, когда необходимо их выполнить.</p>



             <h3 id="syn">Синтаксис.</h3>
             <p>Когда скрипт запускается в подоболочке, вы должны указать, какая командная оболочка должна запустить скрипт. Тип оболочки, для которой вы написали скрипт, может не оказаться оболочкой, используемой в вашей системе по умолчанию, так что команды, которые вы вводите, могут привести к ошибкам, если они выполняются неверной оболочкой.</p>
             <p>В первой строке скрипта указывается оболочка, которая должна быть запущена. Первыми двумя символами в первой строке должны быть символы "#!", затем следует указать путь к командной оболочке, которая должна интерпретировать команды, следующие далее. Пустые строки также считаются строками, так что не начинайте свой скрипт с пустой строки.</p>
             <p>В данном курсе все скрипты должны начинаться со следующей строки:</p>
<pre class="prettyprint">
#!/bin/bash 
</pre>   

            <p>Как уже указывалось ранее, это означает, что исполняемый файл Bash можно найти в директории /bin.</p>

            <p>Так же все файлы скриптов должны быть исполняемыми, то есть им требуется прописать права командой chmod (так чтобы у пользователя(ну либо у всех) стояла 7-ка в правах).</p>



            <p><b>Переменные</b></p>
            <p>Для того, что бы объявить переменную в bash, сперва необходимо выбрать имя этой переменной. Имя переменной регистрозависемо. Лучше всего в имени переменной использовать верхний регистр букв. Конечно же вы свободны использовать любые буквы или цифры, главное, что бы имя не начиналось с цифры. Необходимо всегда помнить о различиях между именем переменной и ее значением. Если variable1 — это имя переменной, то $variable1 — это ссылка на ее значение. «Чистые» имена переменных, без префикса $, могут использоваться только при объявлении переменный, при присваивании переменной некоторого значения, при удалении (сбросе), при экспорте и в особых случаях — когда переменная представляет собой название сигнала. Давайте переделаем наш скрипт «Hellow World» так что бы в нем появилась переменная:</p>

<pre class="prettyprint">
#!/bin/bash
STRING="Hellow World"
echo $STRING 
</pre> 

            <p><b>Команды</b></p>
            <p>
                <ol>
                    <li>break выход из цикла for, while или until</li>
                    <li>continue выполнение следующей итерации цикла for, while или until</li>
                    <li>echo вывод аргументов, разделенных пробелами</li>
                    <li>exit выход из оболочки</li>
                    <li>export отмечает аргументы как переменные для передачи в дочерние процессы в среде</li>
                    <li>kill посылает сигнал завершения процессу</li>
                    <li>read читает строку из ввода оболочки и использует ее для присвоения значений указанным переменным.</li>
                    <li>return заставляет функцию оболочки выйти с указанным значением</li>
                    <li>wait ждет выхода из дочернего процесса и сообщает выходное состояние.</li>
                    <li>test или [ ... ] — сравнение целых чисел, символьных строк, определение существования файлов</li>

                </ol>
            </p>

            <p>Типы переменных в bash
            В отличие от большинства других языков программирования, Bash не производит разделения переменных по «типам». По сути, переменные Bash являются строковыми переменными, но, в зависимости от контекста, Bash допускает целочисленную арифметику с переменными.</p>

            <p>Исполнение shell-процедуры внешне ничем не отличается от исполнения любой команды Unix. Для передачи информации в процедуру существует 3 способа: 
            <ol>
                <li>через позиционные параметры при вызове процедуры</li>
                <li>через глобальные переменные (переменные среды операционной системы)</li>
                <li>путем ввода информации командой read во время выполнения процедуры</li>
            </ol>
             </p>

             <p>В процедуре можно использовать любые конструкции, допустимые в командной строке операционной системы (именованные и неименованные программные каналы, конвейеры команд, переадресацию ввода-вывода и т.д.). </p>

             <p>Позиционные параметры процедуры в теле процедуры имеют имена: $0, $1, $2 и т.д., где $0 – имя процедуры, $1 – первый позиционный параметр процедуры, $2 – второй позиционный параметр процедуры и т.д. </p>

             <p>Для организации ветвящихся алгоритмов обработки в процедурах используется конструкция:</p>
<pre class="prettyprint">
if <список команд 1> then <список команд 2> else <список команд 3>
fi
</pre>         
            <p>Или</p>

<pre class="prettyprint">
if <список команд 1> then <список команд 2> fi
</pre> 


<pre class="prettyprint">
#!/bin/sh

a=10
b=20

if [ $a == $b ]
then
   echo "a is equal to b"
else
   echo "a is not equal to b"
fi
</pre> 

<pre class="prettyprint">
    
if [ -z "$myvar" ]
then
     echo "Переменная 'myvar' не определена."
fi

</pre>

<pre class="prettyprint">
    
if [ "$myvar" -eq 3 ]
then 
     echo "myvar равно 3"
fi

</pre>


            <p>В качестве команд возвращающих код возврата могут выступать структуры [[ , [ , test, (( )) или любая другая(или несколько) 
            linux-команда "test" - используется для логического сравнения. после выражения, необходима закрывающая скобка "]"
            [ - синоним команды test
            [[ - расширенная версия "[" (начиная с версии 2.02)(как в примере), внутри которой могут быть использованы || (или), & (и). Должна иметь закрывающую скобку "]]"
            (( )) - математическое сравнение.</p>

            <p>Cписок логических операторов, которые используются для конструкции if-then-else-fi:

            <ol>
                <li>-z # строка пуста</li>
                <li>-n # строка не пуста</li>
                <li>=, (==) # строки равны</li>
                <li>!= # строки неравны</li>
                <li>-eq # равно</li>
                <li>-ne # неравно</li>
                <li>-lt,(< ) # меньше</li>
                <li>-le,(<=) # меньше или равно</li>
                <li>-gt,(>) #больше</li>
                <li>-ge,(>=) #больше или равно</li>
                <li>! #отрицание логического выражения</li>
                <li>-a,(&&) #логическое «И»</li>
                <li>-o,(||) # логическое «ИЛИ»</li>

            </ol>

            </p>


            <p>Для организации циклических алгоритмов используются конструкции:</p>

<pre class="prettyprint">
while <список команд 1> do <список команд 2> done
</pre> 
<pre class="prettyprint">
until <список команд 1> do <список команд 2> done
</pre> 
<pre class="prettyprint">
for <переменная> = <строка> do <список команд 2> done
</pre> 
<pre class="prettyprint">
for ((expr1; expr2;   exprN ))  do <список команд 2> done
</pre> 

            <p>В первой конструкции циклически выполняется список команд 2 до тех пор, пока код возврата последней команды из списка 1 остается равным 0.</p>
            <p>Во второй конструкции выполняется список команд 2 до тех пор, пока код возврата последней команды из списка 1 остается не равным 0.</p>
            <p> третьей конструкции список команд 2 выполняется 1 раз для каждого значения переменной, которая последовательно приравнивается к очередному слову из строки.</p>
            <p>В четвертой конструкции список команд выполняется по одному разу для каждого из указанных выражений.</p>

            <img src="image/lab11/image026.gif">

            <p>Так же имейте в виду, что скрипт можно запустить прямо из командной строки, вот таким способом прямо в косноли введя скрипт.</p>


<pre class="prettyprint">
$ for f in $( ls /var/ ); do echo $f; done 
</pre> 

            <h3 id="examp">Примеры</h3>
            <p><b>Так же примеры скриптов есть в ссылках.</b></p>
<pre class="prettyprint">
#перемещает все файлы в каталог, удалит его вместе с содержимым, а затем создаст это каталог заново.
#!/bin/bash
touch file1
mkdir trash
mv file1 trash
rm -rf trash
mkdir trash
echo “Файл удален!”
</pre>

<pre class="prettyprint">
#!/bin/bash
# Эта программа считает от 1 до 10:
for i in 1 2 3 4 5 6 7 8 9 10; do
echo $i
done  
</pre>

<pre class="prettyprint">
#Проверяем нахождение подстроки в строке

string='My string';
 
if [[ "$string" == "My" ]]
then
  echo "It's there!";
fi
 
needle='y s'
if [[ "$string" == "$needle" ]]; then
  echo "haystack '$string' contains needle '$needle'"
fi
</pre> 

<pre class="prettyprint">
#Итерация по переданным аргументам
for var in "$@"
do
    echo "$var"
done
</pre> 

<pre class="prettyprint">
#Встроенный if/else
#!/bin/bash
 
# объявление выбранной переменной и присваивание ей значения 4
choice=4
# Вывод на stdout
 echo "1. Bash"
 echo "2. Scripting"
 echo "3. Tutorial"
 echo -n "Please choose a word [1,2 or 3]? "
# Повторение цикла, пока переменная равна 4
# bash цикл while 
while [ $choice -eq 4 ]; do
 
# чтение введенного значения
read choice
# bash nested if/else
if [ $choice -eq 1 ] ; then
 
        echo "You have chosen word: Bash"
 
else                   
 
        if [ $choice -eq 2 ] ; then
                 echo "You have chosen word: Scripting"
        else
         
                if [ $choice -eq 3 ] ; then
                        echo "You have chosen word: Tutorial"
                else
                        echo "Please make a choice between 1-3 !"
                        echo "1. Bash"
                        echo "2. Scripting"
                        echo "3. Tutorial"
                        echo -n "Please choose a word [1,2 or 3]? "
                        choice=4
                fi   
        fi
fi
done 

</pre>

<pre class="prettyprint">
#!/bin/bash
 
# bash цикл
for f in $( ls /var/ ); do
    echo $f
done 
</pre>
            <h3 id="task">Задание</h3>
            <p>За заданием подходить к преподавателю.</p>

             <h3 id="qwe">Контрольные вопросы</h3>
             <ol>
                 <li>Какое назначение имеют shell - файлы? Примеры использования.</li>
                 <li>Как написать скрипт?</li>
                 <li>Как создать shell - файл и сделать его выполняемым?</li>
             </ol>

			<h3 id="source">Ссылки</h3>
			<ol>
				<li><a href="http://gnu.su/news.php?extend.1613"> Статья о BASH</a></li>
				<li><a href="https://habrahabr.ru/post/47163/"> Статья #1 с хабра о BASH </a></li>
				<li><a href="https://habrahabr.ru/post/52871/"> Статья #2 с хабра о BASH </a></li>
                <li><a href="http://help.ubuntu.ru/manual/терминал"> Гайд по терминалу в Ubuntu </a></li>
                <li><a href="http://www.emb-linux.narod.ru/shell/bash.html"> Примеры с BASH</a></li>
                <li><a href="http://linuxgeeks.ru/bash-1.htm"> Примеры с BASH</a></li>
			</ol>
			

            </div>
        </div>
    </section>
</div>
<script src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/prettify/prettify.js"></script>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=css&skin=sunburst"></script>
<script src="js/layout.js"></script>
</body>
</html>

