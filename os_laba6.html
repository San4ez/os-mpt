<!DOCTYPE html>
<html>
<head>
	<title>Практическая работа #6</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="720">
	<link rel="stylesheet" href="css/style.css">
    <link href="http://fonts.googleapis.com/css?family=Raleway:700,300" rel="stylesheet"
          type="text/css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/prettify.css">
</head>
<body>


<div class="wrapper">
    <nav>
        <div class="pull-left">
            <h1><a href="/os-mpt"><span>Все материалы</span></a></h1>
        </div>
        <div class="pull-right">
        </div>
    </nav>
    <header>
        <div class="container">
            <h2 class="lone-header">Лабораторная #6 по ОС</h2>
        </div>
    </header>
    <section>
        <div class="container">
            <ul class="docs-nav">
                <li><a href="#init" class="cc-active">Введение</a></li>
                <li><a href="#work" class="cc-active">Как работать</a></li>
                <li><a href="#exe" class="cc-active">Выполнение</a></li>
                <li><a href="#param" class="cc-active">Остальные параметры</a></li>
				<li><a href="#consol" class="cc-active">Работа через консоль</a></li>
				<li><a href="#qwe" class="cc-active">Контрольные вопросы</a></li>
				<li><a href="#source" class="cc-active">Ссылки</a></li>
            </ul>
            <div class="docs-content">
            <h2>Лабораторная работа №6 - Работа с реестром в Windows.
			</h2>

			<b>Цель работы:</b> Получить представление о работе с реестром Windows.

             <h3 id="init">Введение</h3>
             <p>Что такое реестр в Windows? </p>
             <p>Согласно докуметации с сайта Microsoft это - Иерархическая централизованная база данных, используемая в ОС Microsoft Windows 98, Windows CE, Windows NT и Windows 2000 для хранения сведений, необходимых для настройки операционной системы для работы с пользователями, программными продуктами и устройствами.</p>
			 
			 <p>В реестре хранятся данные, которые необходимы для правильного функционирования Windows. К ним относятся профили всех пользователей, сведения об установленном программном обеспечении и типах документов, которые могут быть созданы каждой программой, информация о свойствах папок и значках приложений, а также установленном оборудовании и используемых портах. </p>
			
			<p>Системный реестр заменяет собой большинство текстовых INI-файлов, которые использовались в Windows 3.x, а также файлы конфигурации MS-DOS, такие как Autoexec.bat и Config.sys. Версии реестра для разных версий операционных систем семейства Windows имеют определенные различия.</p>
             
			 <p>Так же есть такое понятие как <b>Куст реестра</b> - это группа разделов, подразделов и параметров реестра с набором вспомогательных файлов, содержащих резервные копии этих данных. Вспомогательные файлы для всех кустов за исключением HKEY_CURRENT_USER хранятся в системах Windows NT 4.0, Windows 2000, Windows XP, Windows Server 2003 и Windows Vista в папке %SystemRoot%\System32\Config. Вспомогательные файлы для куста HKEY_CURRENT_USER хранятся в папке %SystemRoot%\Profiles\Имя_пользователя. Расширения имен файлов в этих папках указывают на тип содержащихся в них данных. Отсутствие расширения также иногда может указывать на тип содержащихся в файле данных.</p>
			 
			 <p><b>Так же имейте в виду, что при работе с реестром большая часть внесенных изменений применяется сразу.</b></p>

			<p><b>Разделы реестра</b></p>
			<p>Сам по себе реестр структурирован и содержит следующие разделы:</p>
			<ol>
				<li><b>HKEY_CURRENT_USER</b> - Данный раздел является корневым для данных конфигурации пользователя, вошедшего в систему в настоящий момент. Здесь хранятся папки пользователя, цвета экрана и параметры панели управления. Эти сведения сопоставлены с профилем пользователя. Вместо полного имени раздела иногда используется аббревиатура HKCU.</li>
				<li><b>HKEY_USERS</b> - 	Данный раздел содержит все активные загруженные профили пользователей компьютера. Раздел HKEY_CURRENT_USER является подразделом раздела HKEY_USERS. Вместо полного имени раздела иногда используется аббревиатура HKU.</li>
				<li><b>HKEY_LOCAL_MACHINE</b> - Раздел содержит параметры конфигурации, относящиеся к данному компьютеру (для всех пользователей). Вместо полного имени раздела иногда используется аббревиатура HKLM.</li>
				<li><b>HKEY_CLASSES_ROOT</b> - Является подразделом HKEY_LOCAL_MACHINE\Software. Хранящиеся здесь сведения обеспечивают выполнение необходимой программы при открытии файла с использованием проводника. Вместо полного имени раздела иногда используется аббревиатура HKCR. Начиная с Windows 2000, эти сведения хранятся как в HKEY_LOCAL_MACHINE, так и в HKEY_CURRENT_USER. Раздел HKEY_LOCAL_MACHINE\Software\Classes содержит параметры по умолчанию, которые относятся ко всем пользователям локального компьютера. </li>
				<li><b>HKEY_CURRENT_CONFIG</b> - Данный раздел содержит сведения о профиле оборудования, используемом локальным компьютером при запуске системы.</li>
			</ol>
			
			<p><b>Типы параметров</b></p>
			<p>Поскольку реестр Windows представляет собой сложную логическую модель базы данных, вся сохраняемая информация, которая располагается в специальных информационных контейнерах (проще говоря - параметрах), должна быть классифицирована. Классификация для хранения в параметрах значений происходит по типу данных, представляющих это значение. Всего таких типов одиннадцать.</p>
			<img src="image/lab6/param_reestr.PNG" >
			
			<p>Что обычно хранится в подобных параметрах</p>
			
			<ol>
				<li><b>REG_BINARY</b> - Необработанные двоичные данные. Большинство сведений об аппаратных компонентах хранится в виде двоичных данных и выводится в редакторе реестра в шестнадцатеричном формате.</li>
				<li><b>REG_DWORD</b> - Данные представлены в виде значения, длина которого составляет 4 байта (32-разрядное целое). Этот тип данных используется для хранения параметров драйверов устройств и служб. Значение отображается в окне редактора реестра в двоичном, шестнадцатеричном или десятичном формате.</li>
				<li><b>REG_EXPAND_SZ</b> - Строка данных переменной длины. Этот тип данных включает переменные, обрабатываемые при использовании данных программой или службой.</li>
				<li><b>REG_MULTI_SZ</b> - Многострочный текст. Этот тип, как правило, имеют списки и другие записи в формате, удобном для чтения. Записи разделяются пробелами, запятыми или другими символами.</li>
				<li><b>REG_SZ</b> - Просто текстовая строка переменной длинны</li>
				<li><b>REG_RESOURCE_LIST</b> - Последовательность вложенных друг в друга массивов</li>
				<li><b>REG_NONE</b> - Данные, не имеющие определенного типа. Такие данные записываются в реестр системой или приложением. В окне редактора реестра отображаются в виде двоичного параметра в шестнадцатеричном формате.</li>
				<li><b>REG_LINK</b> - Символическая ссылка</li>
				<li><b>REG_QWORD</b> - Данные, представленные в виде 64-разрядного целого. Начиная с Windows 2000, такие данные отображаются в окне редактора реестра в виде двоичного параметра.</li>
			</ol>
			
			<p>Где эти параметры посмотреть? Например, вот, на данном скриншоте указаны параметры (наверно для какой то игрушки) все они представляют из себя текстовые строки.</p>
			<img src="image/lab6/view_param.PNG" >
			<p>Или вот например содержимое параметра REG_BINARY, то есть просто двоичные данные.<p>
			<img src="image/lab6/param_bin.png" >
			
			
			
			<h3 id="work">Как работать</h3>
			<p>В процессе загрузки система получает монопольный доступ к данным файлам и, поэтому, стандартными средствами работы с файлами вы ничего с ними сделать не сможете (открыть для просмотра, скопировать, удалить, переименовать). Для работы с содержимым системного реестра используется специальное программное обеспечение - редакторы реестра (REGEDIT.EXE, REGEDT32.EXE), являющиеся стандартными компонентами операционной системы. Для запуска реестра используется "Пуск" "Выполнить" - regedit.exe. Выглядит все это вот так: </p>
			<img src="image/lab6/view_reestr.PNG" >
			<p>Структруа окна довольно проста, в левой его части древовидное структура реестра, справой его части, параметры. Так же имейте в виду, что возможности конкретного пользователя при редактировании данных реестра определяются его правами в системе.<p>
			
			<p><b>  В процессе загрузки и функционирования операционной системы выполняется постоянное обращение к данным реестра как для чтения, так и для записи. Даже один неверный параметр в реестре может привести к краху системы, как и нарушение целостности отдельных файлов. Поэтому, прежде чем экспериментировать с реестром, позаботьтесь о возможности его сохранения и восстановления. </b></p>
			
			
			<h3 id="exe">Выполнение</h3>
			<p><b>Если вдруг в конце нужного пути, будет не хватать папки, то досоздадите, что требуется.</b></p>
			<p><b>Первое</b> что вы сделаетеы будет бекапом реестра, для это нужно в меню сверху выбрать Файл->Экспорт и сохранить файл куда-нибудь. Потом их этого сохранённого файла можно будет откатить рееcтр к тому моменту пока вы его не сломали. Так же там можно выбирать не весь реестр, а только его отдельную ветку.</p>
			<img src="image/lab6/export_reestr.PNG">
			
			
			<p><b>Второе</b> что вы будете делать это изменять параметры реестра таким образом, чтобы изменить пункты меню в контекстном меню Windows.</p>
			<p>Для этого нужно:</p>
			<ol>
				<li>Сначала надо перейти в /HKEY_CLASSES_ROOT/exefile/shell/rusas
				<img src="image/lab6/runas.png"></li>
				<li>Двойным щелчком щёлкаете по первому параметру(который «По умолчанию») и изменяете его на что пожелаете<img src="image/lab6/imperor.png"></li>
				<li>Можете добавить иконку, для этого требуется создать новый строковый параметр и написать в него путь до изображения (желательно чтобы картинка была в ICO и размером в 16x16 px) <img src="image/lab6/icon.jpg">
				<img src="image/lab6/icon2.png"></li>
				
				<li>Вот такое контекстное меню получилось у меня. <img src="image/lab6/image006.jpg"></li>			
			</ol>
			
						
			<p><b>Третье</b> что требуется сделать это добавить новую кнопку в контекстное меню. В данном случае мы добавим кнопку которая удаляет содержимого папки без удаления самой папки
			Т.е. вам не придется открывать папку, выделять все файлы и нажимать на клавишу Delete, достаточно будет выбрать команду "Удалить содержимое папки". </p>
			<p>Чтобы это сделать надо:</p>
			<ol>
				<li>Добавляем в раздел HKEY_CLASSES_ROOT\Directory\shell подраздел DeleteFolderContent и в его параметре по умолчанию прописываем текст для названия контекстного меню <img src="image/lab6/add_dir.jpg">
				<img src="image/lab6/add_dir2.png"></li>
				<li>Далее в разделе DeleteFolderContent создаем подраздел command и в значении параметра по умолчанию прописываем строчку: <img src="image/lab6/def_param.png"></li></li>
<pre class="prettyprint">
cmd /c "cd /d %1 && del /s /f /q *.*"
:: данная строка вызывает cmd с параметрами
</pre>	
				
				<li>Все готово и можете пользоваться примером и удалять содержимое папок. <img src="image/lab6/add_menu.jpg"></li>
			</ol>
			
			<p><b>Четвертое</b> что от вас требуется это заблокировать диспетчер задач</p>
			<ol>
				<li>С помощью реестра можно разблокировать или заблокировать диспетчер задач. Откройте regedit и перейдите к «HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\». Если в левой части, ниже «Policies», Вы не обнаружите директорию «System» щелкните правой кнопкой мыши по «Policies» и выберите пункт «Создать», а потом «Раздел». Чуть ниже появится новая папка, которую вам надо переименовать в «System». </li>
				<li>Далее, в окне с параметрами (это справа), тыкните правой кнопкой мышки, выберите Создать -> Параметр DWORD и задайте ему имя DisableTaskMgr. </li>		
				<li>Тыкните по нему правой кнопкой мыши и выберите пункт «Изменить». В строке ввода значения поставьте 1 для выключения (или 0 для включения) диспетчера задач</li>
				<li>А затем установите переключатель «Система исчисления» на «Десятичная». После этого, при попытке вызова диспетчера задач будет появляться «Диспетчер задач отключён администратором» (или наоборот это сообщение исчезнет, если он был заблокирован).</li>
			</ol>
			
			<p><b>Пятое</b>, что от вас потребуется сделать это попробовать ограничить доступ пользователя к ресурсам, а именно просто убрать логические диски. Параметры в разделе HKEY_CURRENT_USER относятся к текущему пользователю системы. Параметры в разделе HKEY_LOCAL_MACHINE - ко всем пользователям.</p>
			<p>Будем работать с текущим пользователем, для этого открываем раздел реестра: HKEY_CURRENT_USER\ Software\ Microsoft\ Windows\ CurrentVersion\ Policies\ Explorer и добавляем в него параметр NoDrives типа DWORD. Вот так:
			<img src="image/lab6/param_nodirves.PNG">
			<img src="image/lab6/view_no_drives.PNG">
			Для каждого диска имеется собственное числовое значение. Приведу значения для разных букв разделов в десятичном счислении (потому как с ними проще оперировать в дальнейшем). Вот пример значений для параметра: A(буква диска)-1(значение),B-2,C-4,D-8,E-16,F-32,G-64 и так далее. И вот так это все выглядит в итоге.
			</p>
			<img src="image/lab6/block_disk.jpg">
			<p>Добавлю, что скрытые таким образом диски не видны только для Explorerа, а в других программах могут быть доступны (в файловых менеджерах, например). Но другие программы ведь можно и скрыть или запретить - о чем дальше.</p>
			<p><b>Конкретно эти изменения отобразятся только после перезагрузки компьютера.</b></p>
			
			
			
			<p><b>Шестое</b>, что вы сделаете, это поработаете с автозагрузкой, для этого перейдите в			HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run, там находятся программы, запускаемые при входе в систему. Создайте строковый параметр и назовите его Video, и в значении укажите путь до какого-либо видео. Так же вы можете назвать ваш параметр pucture и указать путь до картинки и любые другие вариации.</p>
			<img src="image/lab6/run_reestr.PNG">
			
			<p><b>Седьмое</b>, что вам потребуется сделать, это заблокировать контекстное меню, для этого идём HKCU\Software\Microsoft\Windows\CurrentVersion\Policles\Explorer и Создаём параметр NoViewContextMenu и придаём ему значение 1.</p>
			
			
						
			
			<h3 id="param">Остальные параметры</h3>
			<p>Далее будут просто перечислены возможные параметры реестра, которые можно изменить и тем самым ограничив доступ пользователя к ресурсам, можете попробовать с ними поиграться. </p>
			
			<p>Читаются они следующим образом - ИмяПараметра=ТипПараметра:значение</p>
			
			<p>Следующие параметры относятся к разделу реестра
			HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Network</p>
			
			<ol>
				<li>NoNetSetup=dword:00000001 отключает доступ к значку "Сеть" в Панели управления</li>
				<li>NoFileSharingControl=dword:00000001 скрывает диалоговое окно управления совместным использованием файлов и принтеров, не позволяя пользователям управлять созданием новых совместных файлов или принтеров</li>
				<li>NoNetSetupIDPage=dword:00000001 скрывает вкладку "Идентификация"</li>
				<li>NoNetSetupSecurityPage=dword:00000001 скрывает вкладку "Управление доступом"</li>
				<li>NoEntireNetwork=dword:00000001 скрывает элемент "Вся сеть" в Сетевом окружении</li>
				<li>NoWorkgroupContents=dword:00000001 скрывает всё содержание Рабочей группы в Сетевом окружении</li>
			</ol>
			
			<p>Следующие параметры относятся к ограничениям для всех пользователей
			Поскольку используется раздел HKEY_LOCAL_MACHINE, а не HKEY_CURRENT_USER. Для редактирования данных нужно обладать правами администратора системы
			HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\System</p>
			<ol>
				<li>NoSecCPL =dword:00000001 отключает доступ к значку "Пароли" в Панели управления</li>
				<li>NoAdminPage=dword:00000001 скрывает вкладку "Удаленное управление"</li>
				<li>NoProfilePage =dword:00000001 скрывает вкладку "Профили пользователей"</li>
				<li>NoPwdPage"=dword:00000001 скрывает вкладку "Смена паролей"</li>
				<li>NoDispCPL=dword:00000001 отключает доступ к значку "Экран" в Панели управления</li>
				<li>NoDispAppearancePage=dword:00000001 скрывает "Оформление" в окне свойств экрана</li>
				<li>NoDispBackgroundPage=dword:00000001 скрывает "Фон" в окне свойств экрана</li>
				<li>NoDispScrSavPage скрывает "Заставка" в окне свойств экрана</li>
				<li>NoDispSettingsPage=dword:00000001 скрывает "Настройка" в окне свойств экрана</li>
			</ol>
			
			<p>Некоторые из перечисленных запретов на действия пользователя используют не только системные администраторы, но и внедрившиеся в систему вирусы. Обычно выполняется запись в реестр данных, блокирующих возможность поиска и удаления внедрившегося вредоносного программного обеспечения и, в качестве завершающего аккорда - запрет на запуск редактора реестра (DisableRegistryTools). Как следствие, даже обладая правами администратора, пользователь не имеет возможности что-либо сделать со своим собственным реестром. </p>
			
			
			<h3 id="consol">Работа через консоль</h3>
			
			<p>Так же с реестром можно работать через консоль Windows посредством утилиты REG, это может быть полезно, когда доступ к программе RegEdit невозможен.</p>
			<p>Синтаксис команды REG выглядит следующим образом:</p>
<pre class="prettyprint">
REG <процедура> [список параметров]
</pre>
			<p>Для получения справки по данной команде используйте REG /?</p>
			<p>Данная команда умеет выполнять одиннадцать различных действий с реестром: QUERY, ADD, DELETE, COPY, SAVE, LOAD, UNLOAD, RESTORE, COMPARE, EXPORT, IMPORT, каждая из этих процедур имеет собственный набор параметров. Попробуем применить несколько из них.</p>
			<p>Сначала попробуем сделать резервную копию ветки реестра через консоль синтаксис прост: </p>
<pre class="prettyprint">
REG SAVE <имя_раздела> <имя_файла> 

REG RESTORE <имя_раздела> <имя_файла>
</pre>			
			<img src="image/lab6/save_reest.PNG">

			<p>Так же для просмотра реестра есть QUERY, её синтаксис:</p>
<pre class="prettyprint">
REG QUERY Раздел [/v Параметр | /ve] [/s]
</pre>	
			<p>Со списком параметров можно ознакомиться в справке Windows, то есть по команде - reg query /?</p>
			
			 <h3 id="qwe">Контрольные вопросы</h3>
			<ol>
				<li>Что такое реестр и что с помощью него можно сделать?</li>
				<li>Как работать с реестром через консоль Windows? Какие для этого существуют команды. </li>
				<li>Как сделать резервную копию реестра?</li>
			</ol>
			 
			 
			 
			  <h3 id="source">Ссылки</h3>
			<ol>
				<li><a href="https://support.microsoft.com/ru-ru/help/256986/windows-registry-information-for-advanced-users">Информация по поводу реестра</a></li>
				<li><a href="http://remontka.pro/hide-disk-partition-windows/">В продолжении темы о сокрытии жестких дисков</a></li>
				<li><a href="http://www.winpedia.ru/content/view/901/58/">Работа с реестром через консоль</a></li>
			</ol>
			
            </div>
        </div>
    </section>
</div>
<script src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/prettify/prettify.js"></script>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=css&skin=sunburst"></script>
<script src="js/layout.js"></script>
</body>
</html>

